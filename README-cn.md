# RAECM: 互联网规模路由器属性识别系统

**RAECM**（Router Asset Evidence-Centric Multi-agent，路由器资产证据中心多智能体系统）是一个面向互联网规模路由器属性识别的自主框架，采用以证据为中心的多智能体方法。

## 📦 系统概述

RAECM解决了将异构且含噪的服务数据大规模转换为细粒度、可审计的语义标签这一持续性挑战。它利用大语言模型（LLM）将轻量级多端口探测测量数据转化为结构化、可验证且可追溯的资产标签。

### 核心成果

- **高准确率**：在ground-truth基准数据集上实现优异性能
- **显著提升**：相比无约束的直接LLM推理有大幅准确率提升
- **成本降低**：相比直接推理方法显著降低成本
- **高效学生模型**：蒸馏模型在高吞吐量场景下保持性能

## 🎯 核心创新

### 1. 以证据为中心的多智能体框架

- **专业化分析员**：将语义标注分解为可扩展的专业化智能体
- **显式证据**：每个预测都基于可验证的证据，并附带可靠性权重
- **事后验证**：CheckAnalyst执行一致性验证和保守修正
- **检索增强生成**：外部知识库支持基于证据的推理

### 2. 互联网规模优化

- **内容哈希**：去重和缓存复用，处理重复观测
- **熵引导排序**：优先处理高信号观测，提升效率
- **教师-学生架构**：蒸馏学生模型处理常规案例
- **轻量级探测**：高效的多端口扫描，最小化开销

### 3. 下游应用

- **指纹构建**：从证据关联的结构化输出自动生成指纹
- **纵向监测**：支持漂移检测和时序分析
- **可审计输出**：可追溯且可维护的识别结果

## 📁 项目结构

```
Analyst-master/
├── README.md              # 项目总览（英文）
├── README-cn.md           # 项目总览（中文）
│
├── recog/                 # 教师端LLM识别流水线
│   ├── Analyst/         # 核心实现
│   ├── run_6analyst.py   # 主入口
│   ├── README.md         # 完整文档（英文）
│   └── README-cn.md      # 完整文档（中文）
│
└── model/                 # 学生模型蒸馏
    ├── training/         # 训练核心
    ├── configs/          # 模型配置
    ├── input/            # 训练数据
    ├── train.py          # 训练入口
    ├── evaluate.py       # 评估入口
    ├── README.md         # 完整文档（英文）
    └── README-cn.md      # 完整文档（中文）
```

## 🚀 快速开始

### 教师流水线（recog）

使用LLM进行高准确率识别：

```bash
cd recog
pip install openai requests
# 在 Analyst/config.py 中配置API
python run_analyst.py
```

**详见 [recog/README-cn.md](recog/README-cn.md) 获取完整文档。**

### 学生模型（model）

使用蒸馏模型进行高吞吐量识别：

```bash
cd model
pip install -r requirements.txt
# 下载模型
python train.py --mt vd --model qwen2.5-3b
python evaluate.py --mt vd
```

**详见 [model/README-cn.md](model/README-cn.md) 获取完整文档。**

## 🎯 系统架构

### 多智能体流水线

```
原始扫描数据
    ↓
数据清洗与规范化
    ├─ 移除敏感字段
    ├─ 过滤噪声
    └─ 计算信息熵
    ↓
产品识别（专业化分析员）
    ├─ 厂商识别
    ├─ 操作系统识别
    └─ 设备类型识别
    ↓
一致性检查（CheckAnalyst）
    ├─ 跨字段验证
    ├─ 证据充分性检查
    └─ 保守修正
    ↓
带证据的结构化输出
```

### 教师-学生架构

```
教师流水线（基于LLM）
    ├─ 高准确率
    ├─ 证据生成
    └─ 复杂案例处理
    ↓
知识蒸馏
    ↓
学生模型（蒸馏后）
    ├─ 高吞吐量
    ├─ 成本效益
    └─ 大规模部署
```

## 📊 使用场景

### 场景1：互联网规模资产发现

```
网络扫描 → RAECM教师 → 资产清单
```

- 执行轻量级多端口探测
- 运行RAECM识别流水线
- 生成带证据的结构化资产清单

### 场景2：高吞吐量监测

```
持续扫描 → RAECM学生 → 快速分类
```

- 部署蒸馏学生模型
- 处理大规模观测数据
- 在保持准确率的同时实现高吞吐量

### 场景3：指纹构建

```
RAECM输出 → 证据聚类 → 自动化指纹
```

- 收集证据关联的结构化输出
- 按证据模式聚类
- 生成可维护的指纹规则

## 🔧 系统要求

### 教师流水线（recog）

- Python 3.8+
- OpenAI兼容API访问
- 网络扫描数据

### 学生模型（model）

- Python 3.8+
- PyTorch 2.0+
- CUDA 11.8+（GPU训练）
- 24GB+ GPU显存

## 📚 文档

每个模块都包含完整的独立文档：

- **[README-cn.md](README-cn.md)**（本文件）- 项目总览
- **[recog/README-cn.md](recog/README-cn.md)** - 教师流水线完整指南
  - 快速开始和安装
  - 配置参考
  - 数据格式和处理
  - API集成
  - 性能优化
  - 常见问题和故障排除
  
- **[model/README-cn.md](model/README-cn.md)** - 学生模型完整指南
  - 训练流程
  - 模型配置
  - 评估指标
  - 部署策略
  - 性能调优
  - 常见问题和最佳实践

## ❓ 常见问题

### Q1：我应该使用哪个模块？

- **教师（recog）**：高准确率识别、证据生成、复杂案例处理
- **学生（model）**：高吞吐量处理、成本效益部署、大规模场景

### Q2：RAECM有什么不同？

| 特性 | 传统指纹识别 | RAECM |
|------|-------------|-------|
| 适应性 | 低（手动更新） | 高（基于LLM） |
| 证据 | 隐式 | 显式且可追溯 |
| 跨端口推理 | 有限 | 全面 |
| 维护 | 高人工成本 | 自动化 |
| 可审计性 | 有限 | 完整溯源 |

### Q3：如何获取训练数据？

- 使用教师流水线（recog）生成标注数据
- 手动标注扫描结果
- 使用现有标注数据集

### Q4：性能权衡是什么？

| 指标 | 教师 | 学生 |
|------|------|------|
| 准确率 | 最高 | 强劲 |
| 吞吐量 | 低 | 高 |
| 成本 | 高 | 低 |
| 延迟 | 高 | 低 |

### Q5：如何针对我的使用场景优化？

**追求准确率**：使用教师流水线配合高质量模型（GPT-4、Claude）

**追求吞吐量**：部署学生模型配合批处理

**追求成本**：使用学生模型进行大规模部署

**追求可审计性**：使用教师流水线启用证据生成和验证

## 🔬 性能指标

基于ground-truth基准评估：

### 总体性能

| 指标 | 描述 |
|------|------|
| 教师准确率 | 基准数据集上的高准确率 |
| 学生准确率 | 高效推理下的强劲准确率 |
| 准确率提升 | 相比直接推理显著提升 |
| 成本降低 | 大幅成本节省 |

### 任务特定性能

| 任务 | 教师 | 学生 |
|------|------|------|
| 厂商识别 | 高准确率 | 强劲准确率 |
| 操作系统识别 | 高准确率 | 强劲准确率 |
| 设备类型 | 高准确率 | 强劲准确率 |

## 🌟 核心优势

### 相比传统指纹识别

- **适应性**：处理未见过的型号和演进的固件
- **跨端口推理**：整合来自多个服务的证据
- **降低维护**：自动化指纹生成
- **证据基础**：每个预测都有可验证的证据支撑

### 相比直接LLM推理

- **更高准确率**：通过多智能体框架提升15.78%
- **更低成本**：通过优化降低48.7%成本
- **更好可靠性**：证据不足时保守弃权
- **可审计性**：显式证据链和溯源


